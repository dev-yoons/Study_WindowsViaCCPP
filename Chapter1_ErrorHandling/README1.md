# Chapter1. 에러핸들링

* 윈도우 함수를 호출하면 호출된 함수는 인자의 유효성을 확인하고 함수의 기능을 수행하려고 한다.

|자료형|실패했을 때의 값|
|---|---|
|VOID|실패하지 않는다.|
|BOOL|실패하면 0을 반환한다. 성공 시 0이아닌값을 반환한다. 반환 값을 TRUE와 비교하면 안 된다.|
|HANDLE|실패하면 주로 NULL을 반환한다. -1로 정의된 INVALID_HANDLE_VALUE를 반환하는 몇몇 함수도 있다.|
|PVOID|실패하면 NULL을 반환한다. 성공하면 PVOID가 데이터를 저장하고 있는 메모리 주소를 가리킨다.|
|LONG/DWORD|성공 시 대개 LONG이나 DWORD형으로 개수를 반환한다. 개수를 반환하지 못하면 0이나 -1을 반환한다.|

* 함수가 실패하면 왜 함수가 실패했는지를 알아내야한다. 마이크로소프트는 발생할 가능성이 있는 모든 에러 코드를 32비트 숫자로 정의해두었다.
* 윈도우 함수가 실패하게 되면 내부적으로 함수를 호출한 스레드의 스레드 지역 저장소에 적절한 에러 코드를 저장해둔다. 따라서 여러 개의 스레드가 동시에 수행되더라도 상호간에 영향 없이 각 스레드별로 에러코드를 유지할 수 있다.
* GetLastError 함수를 통해 가장 최근에 호출된 함수의 에러 코드를 스레드 지역 저장소로부터 가져올 수 있다.
```C++ 
    DWORD GetLastError();
```
* WinError.h 헤더 파일에는 모든 에러 코드의 리스트가 들어 있다. 에러는 메시지 ID (GetLastError 반환값), 메시지 텍스트 (에러 설명), 에러 코드 의 3가지로 구성된다.
* 함수 호출이 실패하면 바로 GetLastError를 호출해야 한다. 다른 함수를 호출하면 다른 함수의 수행 결과가 겹쳐 써진다. 함수 호출이 성공하면 ERROR_SUCCESS를 에러 코드로 기록한다.
* 몇몇 함수의 경우 함수 호출이 성공한 이유를 확인하기 위해 함수 호출이 성공해도 GetLastError를 호출해야할 수도 있다. 
####
* Visual Studio 내에 포함된 디버거에서 Watch 창을 통해 현재 수행 중인 스레드의 마지막 에러 코드와 메시지 텍스트를 확인할 수 있다.
* Watch 창에서 특정 행을 선택하고 $err, hr 을 입력하면 된다.

### Section 01. 자신만의 에러 코드 정의

* 스레드의 마지막 에러 코드를 설정하기 위해서 SetLastError 함수를 호출할 수 있다.
```C++
VOID SetLastError(DWORD dwErrCode);
```
|비트|31-30|29|28|27-16|15-0|
|---|---|---|---|---|---|
|내용|심각도|마이크로소프트 혹은 고객|예약됨|식별코드|예외코드|
|의미|0=성공<br/>1=정보<br/>2=주의<br/>3=에러|0=마이크로소프트가 정의한 코드<br/>1=고객이 정의한 코드|항상 0|256까지는 마이크로소프트가 예약함|마이크로소프트나 고객이 정의한 코드|
