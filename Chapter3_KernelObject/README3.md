# Chapter3. 커널 오브젝트
* 커널 오브젝트와 그 핸들을 다루는 마이크로소프트 윈도우 애플리케이션 프로그래밍 인터페이스 (API) 에 대한 설명으로부터 시작한다.
### Section 01. 커널 오브젝트란 무엇인가?
* 운영체제는 엑세스 토큰 오브젝트, 이벤트 오브젝트, 파일 오브젝트 등 다양한 형태의 커널 오브젝트를 생성하고 조작한다.
* WinObj를 사용하면 모든 커널 오브젝트 타입을 나열하고 확인해볼 수 있다.
* 이러한 오브젝트들은 다양한 종류의 함수들을 통해 만들어진다. 하지만 함수의 이름에 포함된 오브젝트의 명칭이 반드시 커널 레벨의 오브젝트 이름과 일치하지는 않는다. CreateFileMapping 함수는 Section 오브젝트를 생성한다.
* *각 커널 오브젝트는 커널에 의해 할당된 간단한 메모리 블록이다.** 이 메모리 블록은 커널에 의해서만 접근이 가능한 구조체로 구성되어 있으며, 커널 오브젝트에 대한 세부 정보들을 저장하고 있다.
* 몇몇 값들은 모든 오브젝트 타입에 공통적으로 존재하지만, 대부분의 값들은 각 오브젝트별로 다르다.
* 커널 오브젝트의 데이터 구조체는 커널에 의해서만 접근이 가능하다. 따라서 애플리케이션에서 데이터 구조체가 저장되어 있는 메모리 위치를 직접 접근하여 그 내용을 변경하는 것이 불가능하다. 구조체에 대한 직접적인 접근을 제한하여 마이크로소프트는 이미 개발되어 있는 애플리케이션에 영향을 미치지 않고도 구조체에 내용을 임의로 추가, 삭제, 변경할 수 있다.
* 구조체에 대해 직접 접근하는 대신, 마이크로소트는 구조체의 내용에 접근할 수 있도록 일련의 함수 집합을 제공하고 있어 이를 통해 커널 오브젝트의 내부적인 값에 접근 가능하다.
* 커널 오브젝트를 생성하는 함수를 호출하면 함수는 각 커널 오브젝트를 구분하기 위한 핸들 값을 반환해준다. 핸들 값은 프로세스 내의 모든 스레드에 의해 사용 가능한 값이지만 특별한 의미를 가지고 있지는 않다. 핸들은 다양한 윈도우 함수들의 매개변수로 전달되는데, 운영체제는 매개변수로 전달된 핸들 값을 통해 어떤 커널 오브젝트를 조작하고자 하는지 구분 가능하다.
* 운영체제를 견고하게 하기 위해 핸들 값들은 프로세스 별로 독립적으로 유지된다. 어떤 스레드가 다른 프로세스의 스레드에게 자신의 핸들 값을 전달하면, 이 핸들 값을 이용하여 수행하는 동작은 실패할 수도 있고 더 좋지 않은 결과를 초래할 수도 있다. 이는 각 프로세스별로 독립된 프로세스 핸들 테이블이 존재하고, 동일한 핸들 값이라도 전혀 다른 커널 오브젝트를 참조할 수 있기 때문이다.
  #### 1) 사용 카운트
  * **커널오브젝트는 프로세스가 아니라 커널에 의해 소유된다.**
  * 다시 말해, 만일 프로세스가 특정 함수를 통해 커널 오브젝트를 생성한 후 종료되어도 반드시 생성된 커널 오브젝트가 프로세스와 함께 삭제되는 것은 아니라는 뜻이다. 대부분의 경우 커널 오브젝트는 프로세스와 함께 삭제되지만, 다른 프로세스가 동일 커널 오브젝트를 사용하고 있따면 커널 오브젝트를 사용하는 모든 프로세스가 종료될 때까지 남아있을 수 있다.
  * 각 커널 오브젝트는 내부적으로 사용 카운트 값을 유지하고 있기 때문에 커널은 이 값을 통해 얼마나 많은 프로세스들이 커널 오브젝트를 사용하고 있는지 알 수 있다. 사용 카운트 값이 0이 되면 커널 오브젝트는 삭제된다.
  #### 2) 보안